<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="net.bitacademy.java72.dao.CompanyDao">
	<resultMap type="Company" id="CompanyMap">
		<id column="comp_no" property="no" />
		<result column="kakao_no" property="kakaoId" />
		<result column="comp_nm" property="companyName" />
		<result column="admin_tel" property="adminTel" />
		<result column="addr_old" property="addressOld" />
		<result column="addr_new" property="addressNew" />
		<result column="lat" property="lat" />
		<result column="lon" property="lon" />
		<result column="elev_bl" property="isElevator" />
		<result column="web_bl" property="isWebPage" />
		<result column="ground_bl" property="onGround" />
		<result column="img_path" property="imgUrl" />
		<result column="img_no" property="imgNo" />
	</resultMap>

	<select id="list" parameterType="map" resultMap="CompanyMap">
		SELECT *,
		FROM comp_tb
		natural join comp_img_tb comp_no order by comp_no limit
		#{currCnt},#{listCnt}
	</select>

	 <select id="list2" parameterType="map" resultMap="CompanyMap">
    SELECT *, round( 6371 * acos( cos( radians(37.539523) ) * cos( radians( comp_tb.lat ) )  * cos( radians( comp_tb.lon ) - radians(127.228149) )+ sin( radians(37.539523) ) * sin( radians( comp_tb.lat ) ) ) ,2) AS distance
    FROM comp_tb
    natural join comp_img_tb comp_no
    HAVING distance &lt; 5
    ORDER BY distance
    LIMIT
    #{currCnt},#{listCnt}
  </select>
  
  <select id="list3" parameterType="map" resultMap="CompanyMap">
    SELECT *, round( 6371 * acos( cos( radians(37.539523) ) * cos( radians( comp_tb.lat ) )  * cos( radians( comp_tb.lon ) - radians(127.228149) )+ sin( radians(37.539523) ) * sin( radians( comp_tb.lat ) ) ) ,2) AS distance
    FROM comp_tb
    left outer join comp_img_tb using(comp_no)
    HAVING distance &lt; 5
    ORDER BY distance
    LIMIT
    #{currCnt},#{listCnt}
  </select>

</mapper>

















